<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taska Elite - Your Profile</title>
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="../css/dashboard.css">
    <link rel="stylesheet" href="../css/overview.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; overflow-x: hidden; }
        .navbar { background: rgba(255, 255, 255, 0.95); box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); backdrop-filter: blur(5px); }
        .dashboard-content { padding: 3rem 1rem; display: flex; justify-content: center; align-items: center; min-height: calc(100vh - 120px); }
        .profile-container { background: #fff; border-radius: 20px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15); width: 100%; max-width: 700px; padding: 2rem; transform: translateY(20px); opacity: 0; animation: slideIn 0.6s ease-out forwards; }
        @keyframes slideIn { to { transform: translateY(0); opacity: 1; } }
        .profile-header { text-align: center; margin-bottom: 2rem; }
        .profile-header h1 { font-size: 2.5rem; color: #2c3e50; margin: 0; text-transform: uppercase; letter-spacing: 2px; }
        .profile-avatar { width: 160px; height: 160px; border-radius: 50%; border: 5px solid #3498db; margin: 0 auto 2rem; transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .profile-avatar:hover { transform: scale(1.05); box-shadow: 0 0 20px rgba(52, 152, 219, 0.5); }
        .profile-details { background: rgba(245, 245, 245, 0.8); border-radius: 15px; padding: 1.5rem; margin-bottom: 2rem; }
        .profile-details p { margin: 0.8rem 0; font-size: 1.1rem; color: #34495e; display: flex; justify-content: space-between; transition: transform 0.3s ease; }
        .profile-details p:hover { transform: translateX(5px); }
        .profile-details strong { color: #2c3e50; font-weight: 600; width: 150px; }
        .toggle-container { text-align: center; margin-bottom: 2rem; }
        .toggle-label { font-size: 1.2rem; color: #2c3e50; margin-bottom: 0.5rem; display: block; font-weight: 500; }
        .custom-toggle { display: none; }
        .toggle-switch { width: 70px; height: 40px; background: #ccc; border-radius: 20px; position: relative; cursor: pointer; transition: background 0.3s ease; display: inline-block; }
        .toggle-switch::after { content: ''; position: absolute; width: 34px; height: 34px; left: 3px; top: 3px; background: #fff; border-radius: 50%; transition: transform 0.3s ease, background 0.3s ease; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); }
        .custom-toggle:checked + .toggle-switch { background: #2ecc71; }
        .custom-toggle:checked + .toggle-switch::after { transform: translateX(30px); background: #fff; }
        .toggle-switch:hover::after { transform: scale(1.1); }
        .custom-toggle:checked + .toggle-switch:hover::after { transform: translateX(30px) scale(1.1); }
        .edit-btn { display: inline-block; padding: 0.8rem 2rem; background: #3498db; color: #fff; text-decoration: none; border-radius: 25px; font-size: 1.1rem; transition: background 0.3s ease, transform 0.3s ease; }
        .edit-btn:hover { background: #2980b9; transform: translateY(-3px); }
        .popup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0); background: #2ecc71; color: #fff; padding: 1.5rem 3rem; border-radius: 15px; box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2); font-size: 1.2rem; z-index: 1000; opacity: 0; transition: transform 0.3s ease, opacity 0.3s ease; text-align: center; }
        .popup.error { background: #e74c3c; }
        .popup.show { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        footer { background: rgba(255, 255, 255, 0.95); padding: 1rem; text-align: center; position: fixed; bottom: 0; width: 100%; box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1); }
        .dark-mode .profile-container { background: #2c3e50; }
        .dark-mode .profile-header h1, .dark-mode .profile-details p, .dark-mode .toggle-label { color: #ecf0f1; }
        .dark-mode .profile-details { background: rgba(44, 62, 80, 0.8); }
        .dark-mode .toggle-switch { background: #7f8c8d; }
        .dark-mode .custom-toggle:checked + .toggle-switch { background: #27ae60; }
        .dark-mode .edit-btn { background: #2980b9; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="logo">Taska Elite</div>
        <ul class="nav-menu">
            <li><a href="overview.html">Overview</a></li>
            <li><a href="explore.html">Explore</a></li>
            <li><a href="connections.html">Connections</a></li>
            <li><a href="profile.html" class="active">Profile</a></li>
            <li><a href="../index.html">Logout</a></li>
        </ul>
        <div class="hamburger">â˜°</div>
        <button class="dark-mode-toggle" onclick="toggleDarkMode()">ðŸŒ™</button>
    </nav>

    <main class="dashboard-content">
        <div class="profile-container">
            <div class="profile-header">
                <h1>Your Profile</h1>
                <img src="../assets/st3.jpg" alt="Profile Avatar" class="profile-avatar" id="profile-avatar">
            </div>
            <div class="toggle-container">
                <label class="toggle-label">Visible as Hiring</label>
                <input type="checkbox" id="hiring-toggle" class="custom-toggle" onchange="toggleHiring()">
                <label for="hiring-toggle" class="toggle-switch"></label>
            </div>
            <div class="profile-details">
                <p><strong>Name:</strong> <span id="name">Loading...</span></p>
                <p><strong>Email:</strong> <span id="email">Loading...</span></p>
                <p><strong>Location:</strong> <span id="location">Loading...</span></p>
                <p><strong>Joined:</strong> <span id="joined">Loading...</span></p>
                <p><strong>Coins:</strong> <span id="coins">Loading...</span></p>
                <p><strong>Profession:</strong> <span id="profession">Loading...</span></p>
                <p><strong>Company:</strong> <span id="company">Loading...</span></p>
                <p><strong>Experience:</strong> <span id="experience">Loading...</span></p>
                <p><strong>Skills:</strong> <span id="skills">Loading...</span></p>
                <p><strong>Education:</strong> <span id="education">Loading...</span></p>
                <p><strong>Bio:</strong> <span id="bio">Loading...</span></p>
                <p><strong>Hobbies:</strong> <span id="hobbies">Loading...</span></p>
                <h3>Connection Requests</h3>
                <div id="request-list"></div>
                <h3>Connections</h3>
                <div id="connections-list"></div>
            </div>
            <div class="profile-actions">
                <a href="update-profile.html" class="edit-btn">Edit Profile</a>
            </div>
        </div>
    </main>

    <div class="popup" id="hiring-popup"></div>

    <footer>
        <p>Â© 2025 Taska Elite. All rights reserved. | <a href="#" class="privacy-policy">Privacy Policy</a></p>
    </footer>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getDatabase, ref, get, set, onValue } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDZIDlEtaNRxODoFhRw0xF2yYFBqqBexqo",
            authDomain: "taska-45011.firebaseapp.com",
            databaseURL: "https://taska-45011-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "taska-45011",
            storageBucket: "taska-45011.firebasestorage.app",
            messagingSenderId: "205487498813",
            appId: "1:205487498813:web:0de2c9eab567482781ec54"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const userId = localStorage.getItem('userId');

        if (!userId) {
            setTimeout(() => {
                alert("Please log in or sign up first.");
                window.location.href = '../login.html';
            }, 1000);
        } else {
            loadProfileData();
        }

        async function loadProfileData() {
            try {
                const userRef = ref(database, `professionalslist/${userId}`);
                const snapshot = await get(userRef);
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    document.getElementById('name').textContent = data.name || 'Not set';
                    document.getElementById('email').textContent = data.email || 'Not set';
                    document.getElementById('location').textContent = data.location || 'Not set';
                    document.getElementById('joined').textContent = data.joined || 'Not set';
                    document.getElementById('coins').textContent = data.coins !== undefined ? data.coins : '0';
                    document.getElementById('profession').textContent = data.profession || 'Not set';
                    document.getElementById('company').textContent = data.company || 'Not set';
                    document.getElementById('experience').textContent = data.experience ? `${data.experience} Years` : 'Not set';
                    document.getElementById('skills').textContent = data.skills || 'Not set';
                    document.getElementById('education').textContent = data.education || 'Not set';
                    document.getElementById('bio').textContent = data.bio || 'Not set';
                    document.getElementById('hobbies').textContent = data.hobbies || 'Not set';
                    document.getElementById('hiring-toggle').checked = data.isHiring || false;
                    if (data.profileImage) document.getElementById('profile-avatar').src = data.profileImage;
                } else {
                    alert("No profile data found. Please update your profile.");
                }
            } catch (error) {
                alert(`Failed to load profile: ${error.message}`);
            }
        }

        async function toggleHiring() {
            const toggle = document.getElementById('hiring-toggle');
            const isHiring = toggle.checked;
            const popup = document.getElementById('hiring-popup');
            try {
                await set(ref(database, `professionalslist/${userId}/isHiring`), isHiring);
                popup.textContent = isHiring ? "Your profile is visible as hiring" : "Your profile is no longer visible as hiring";
                popup.classList.add('show');
                setTimeout(() => popup.classList.remove('show'), 2000);
            } catch (error) {
                alert("Failed to update hiring status: " + error.message);
                toggle.checked = !isHiring;
            }
        }

        // Connection Requests
        const requestList = document.getElementById('request-list');
        onValue(ref(database, 'connection_requests'), (snapshot) => {
            requestList.innerHTML = '<h4>Sent Requests</h4>';
            snapshot.forEach((childSnapshot) => {
                const req = childSnapshot.val();
                if (req.from === userId && req.status === 'pending') {
                    get(ref(database, `studentslist/${req.to}`)).then((snap) => {
                        const student = snap.val();
                        requestList.innerHTML += `<p>Pending request to ${student.name}</p>`;
                    });
                }
            });
        });

        // Connections List
        const connectionsList = document.getElementById('connections-list');
        onValue(ref(database, `professionalslist/${userId}/connections`), (snapshot) => {
            connectionsList.innerHTML = '';
            if (snapshot.exists()) {
                snapshot.forEach((childSnapshot) => {
                    const studentId = childSnapshot.key;
                    get(ref(database, `studentslist/${studentId}`)).then((snap) => {
                        const student = snap.val();
                        connectionsList.innerHTML += `
                            <p>${student.name} - Connected since ${new Date(childSnapshot.val().connectedAt).toLocaleDateString()}</p>
                        `;
                    });
                });
            } else {
                connectionsList.innerHTML = '<p>No connections yet.</p>';
            }
        });
    </script>
</body>
</html>