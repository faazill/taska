<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taska Elite - Explore IIT Talent</title>
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="../css/dashboard.css">
    <link rel="stylesheet" href="../css/overview.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: #F9FAFB; min-height: 100vh; color: #6B7280; padding-bottom: 60px; }
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo { font-size: 1.5rem; font-weight: 600; color: #2c3e50; }
        .nav-menu { display: flex; gap: 1.5rem; list-style: none; }
        .nav-menu a { color: #2c3e50; text-decoration: none; font-weight: 500; }
        .nav-menu a:hover, .nav-menu a.active { color: #0000ff; }
        .hamburger { display: none; font-size: 1.5rem; cursor: pointer; }
        .dashboard-content { padding: 2rem 1rem; max-width: 1200px; margin: 0 auto; }
        .dashboard-section h1 { font-size: 2rem; color: #374151; margin-bottom: 0.5rem; }
        .dashboard-section p { font-size: 1rem; margin-bottom: 1.5rem; }
        .search-container {
    background: linear-gradient(135deg, #ffffff 0%, #ffffff 100%);
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    margin: 2rem 0;
    position: relative;
    overflow: hidden;
}

.search-container::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(43, 108, 176, 0.1) 0%, transparent 70%);
    pointer-events: none;
}

/* Enhanced Search Box */
.search-box {
    display: flex;
    align-items: center;
    gap: 1rem;
    background: #ffffff;
    padding: 0.5rem;
    border-radius: 50px;
    border: none;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
    transition: all 0.3s ease;
    position: relative;
    z-index: 1;
}

.search-box:hover,
.search-box:focus-within {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
}

.search-icon {
    color: #2B6CB0;
    font-size: 1.4rem;
    margin-left: 1rem;
    transition: transform 0.3s ease;
}

.search-box:hover .search-icon {
    transform: scale(1.1);
}

.search-input {
    flex: 1;
    border: none;
    background: transparent;
    padding: 1rem 0.5rem;
    font-size: 1.1rem;
    color: #374151;
    outline: none;
    font-weight: 400;
    border-radius: 50px;
}

.search-input::placeholder {
    color: #9CA3AF;
    font-style: italic;
}

.search-btn {
    padding: 0.9rem 2rem;
    background: linear-gradient(90deg, #2B6CB0 0%, #1E4A80 100%);
    color: #FFFFFF;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.search-btn:hover {
    background: linear-gradient(90deg, #2C5282 0%, #1A3A66 100%);
    transform: scale(1.05);
}

.search-btn::after {
    content: '';
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    background: rgba(255, 255, 255, 0.2);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.search-btn:hover::after {
    opacity: 1;
}

.btn-text {
    font-size: 1.1rem;
}

.btn-icon {
    font-size: 1rem;
    transition: transform 0.3s ease;
}

.search-btn:hover .btn-icon {
    transform: translateX(4px);
}
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(249, 250, 251, 0.9); display: none; justify-content: center; align-items: center; z-index: 1001; }
        .loader { width: 200px; height: 4px; background: #E5E7EB; position: relative; overflow: hidden; border-radius: 2px; }
        .loader::before { content: ''; position: absolute; left: -50%; height: 100%; width: 50%; background: #374151; animation: lineLoading 1.5s infinite ease-in-out; }
        @keyframes lineLoading { 0% { left: -50%; } 50% { left: 50%; } 100% { left: 150%; } }
        .students-list { display: grid; grid-template-columns: 1fr; gap: 1rem; margin-top: 3rem; }
        .student-card { background: #FFFFFF; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); }
        .student-card h3 { font-size: 1.25rem; color: #374151; margin-bottom: 0.25rem; }
        .student-card h4 { font-size: 1rem; color: #6B7280; font-weight: 400; margin-bottom: 0.5rem; }
        .student-card p { font-size: 0.9rem; color: #6B7280; margin-bottom: 0.75rem; }
        .student-actions { display: flex; justify-content: space-between; align-items: center; }
        .ai-intro-btn { padding: 0.5rem 1rem; background: #2B6CB0; color: #FFFFFF; border: none; border-radius: 20px; cursor: pointer; font-weight: 500; }
        .ai-intro-btn:hover { background: #2C5282; }
        .view-profile { color: #374151; text-decoration: underline; cursor: pointer; font-size: 0.9rem; }
        .view-profile:hover { opacity: 0.7; }
        .social-icons { display: flex; gap: 0.75rem; }
        .social-icon { font-size: 1.25rem; color: #374151; cursor: pointer; }
        .social-icon:hover { transform: scale(1.1); }
        .social-icon.linkedin:hover { color: #0077B5; }
        .pagination { display: none; }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.3); z-index: 999; }
        .overlay.active { display: block; }
        .profile-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #FFFFFF;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1000;
        }
        .profile-popup.active { display: block; }
        .profile-section { padding: 1rem; }
        .profile-section h2 { font-size: 1.5rem; color: #374151; margin-bottom: 1rem; text-align: center; }
        .profile-section p { font-size: 0.9rem; margin-bottom: 0.75rem; line-height: 1.4; }
        .profile-section p strong { color: #374151; font-weight: 500; display: inline-block; width: 100px; }
        .message-popup {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #FFFFFF;
    padding: 2rem;
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    width: 90%;
    max-width: 450px;
    height: 65vh;
    z-index: 1000;
    border: 1px solid #F0F0F0;
}
.message-popup.active { display: flex; flex-direction: column; }
.message-popup h2 {
    font-size: 1.5rem;
    color: #1A1A1A;
    margin-bottom: 1.5rem;
    text-align: center;
    font-weight: 600;
}
.message-popup textarea {
    width: 100%;
    flex-grow: 1;
    padding: 1rem;
    border: 1px solid #E0E0E0;
    border-radius: 8px;
    margin-bottom: 1.5rem;
    resize: none;
    font-size: 1rem;
    background: #FAFAFA;
    color: #333;
    outline: none;
    transition: border-color 0.3s ease;
}
.message-popup textarea:focus { border-color: #2B6CB0; }
.message-popup .send-btn {
    padding: 0.75rem;
    width: 100%;
    background: #2B6CB0;
    color: #FFFFFF;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 500;
    font-size: 1rem;
    transition: background 0.3s ease;
}
.message-popup .send-btn:hover { background: #2C5282; } .close-btn { position: absolute; top: 0.5rem; right: 0.5rem; background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #6B7280; }
        .close-btn:hover { color: #374151; }
        @media (max-width: 768px) {
    .message-popup { padding: 1.5rem; max-width: 90%; height: 65vh; }
    .message-popup h2 { font-size: 1.25rem; margin-bottom: 1rem; }
    .message-popup textarea { font-size: 0.9rem; }
    .message-popup .send-btn { font-size: 0.9rem; }
}
        footer { background: #FFFFFF; padding: 1rem; text-align: center; position: fixed; bottom: 0; width: 100%; box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05); }
        @media (max-width: 768px) {
            .search-container {
        padding: 1rem;
        margin: 1.5rem 0;
        border-radius: 6px; /* Consistent with desktop */
    }

    .search-box {
        gap: 0.6rem; /* Slightly reduced but keeps layout */
        padding: 1rem;
        border-radius: 6px; /* Consistent with desktop */
    }

    .search-icon {
        display: none; /* Hide icon on mobile */
        font-size: 1.2rem; /* Slightly smaller */
        margin-left: 0.8rem;
    }

    .search-input {
        padding: 0.8rem 0.4rem;
        font-size: 0.95rem; /* Scaled down proportionally */
    }

    .search-btn {
        padding: 0.8rem 1rem; /* Adjusted for icon-only */
        border-radius: 6px; /* Consistent with desktop */
    }
    .btn-text {
        font-size: 0.95rem;
    }

    .btn-icon {
        font-size: 0.9rem;
    }
            .navbar { padding: 1rem; }
            .nav-menu { display: none; position: absolute; top: 60px; left: 0; width: 100%; background: #FFFFFF; flex-direction: column; padding: 1rem; }
            .nav-menu.active { display: flex; }
            .hamburger { display: block; }
            .search-box { flex-direction: column; align-items: stretch; gap: 0.5rem; }
            .search-btn { margin-top: 0.5rem; }
            .message-popup { padding: 1rem; }
            .message-popup h2 { font-size: 1.1rem; }
            .message-popup textarea { font-size: 0.85rem; }
            .message-popup .send-btn { font-size: 0.9rem; }
        }
        @media (min-width: 768px) {
            .students-list { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <a href="../index.html"><div class="logo">Taska Elite</div></a>
        <ul class="nav-menu">
            <li><a href="explore.html" class="active">Explore</a></li>
            <li><a href="profile.html">Account</a></li>
        </ul>
        <div class="hamburger">☰</div>
    </nav>

    <main class="dashboard-content">
        <section class="dashboard-section">
            <br><br>
            <h1>Explore IIT Talent</h1>
            <p>Find and connect with top IIT prodigies using AI-powered search.</p>
            
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" id="ai-search-input" 
                           placeholder="e.g., IIT Delhi B.Tech Applied Mechanics student with Python skill">
                    <button class="search-btn" onclick="performSearch()">
                        <span class="btn-text">Search Talent</span>
                        <i class="fas fa-arrow-right btn-icon"></i>
                    </button>
                </div>
            
            <div class="loading-overlay" id="loadingOverlay">
                <div class="loader"></div>
            </div>
            <div class="students-list" id="students-list"></div>
            <div class="pagination" id="pagination"></div>
        </section>
    </main>

    <footer>
        <p>© 2025 Taska Elite. All rights reserved. | <a href="#">Privacy Policy</a></p>
    </footer>

    <div class="overlay" id="overlay"></div>
    <div class="profile-popup" id="profilePopup">
        <button class="close-btn" onclick="closeProfilePopup()">×</button>
        <div class="profile-content" id="profileContent"></div>
    </div>

    <div class="message-popup" id="messagePopup">
        <button class="close-btn" onclick="closeMessagePopup()">×</button>
        <h2>Connect</h2>
        <textarea id="introMessage" placeholder="Generating message..."></textarea>
        <button class="send-btn" onclick="sendMessage()">Send via WhatsApp</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelector('.hamburger').addEventListener('click', () => {
                document.querySelector('.nav-menu').classList.toggle('active');
            });
        });

        const part1 = 'sk-proj-3F9d8rVuPthYn2jvKneznUYN-ZYaFSy0nKkKIJ5IOEVdjRQdGebYsRkkmJqn25YfZNDLUY12S6T3BlbkFJVBfH9b';
        const part2 = 'EfOVjVB3iRmikjAcyzHapDxOwLArvNo2eln91xFnjyR_D-Mo7XeXcjgcdjRiTueSh8MA';
        const apiKey = part1 + part2;        
        let studentsData = [];
        let currentStudentId = null;

        const studentsList = document.getElementById('students-list');
        const profilePopup = document.getElementById('profilePopup');
        const profileContent = document.getElementById('profileContent');
        const overlay = document.getElementById('overlay');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const messagePopup = document.getElementById('messagePopup');
        const introMessage = document.getElementById('introMessage');

        document.addEventListener('DOMContentLoaded', () => {
            fetch('manualstudentlist.json')
                .then(response => response.json())
                .then(data => {
                    studentsData = data.map((student, index) => ({
                        ...student,
                        id: student.id || `student_${index}`
                    }));
                })
                .catch(error => {
                    console.error('Error loading JSON:', error);
                    studentsList.innerHTML = '<p>Error loading student data.</p>';
                });
        });

        async function aiSearch(query = '') {
            if (!query) {
                studentsList.innerHTML = '<p>Please enter a search query</p>';
                return;
            }

            loadingOverlay.style.display = 'flex';

            const csvText = [
                ['id', 'personal.name', 'education.college', 'education.degree', 'education.branch', 'education.year', 'skills', 'experience'].join(','),
                ...studentsData.map(student => [
                    student.id,
                    student.personal?.name || 'Unnamed',
                    student.education?.college || 'Not set',
                    student.education?.degree || 'Not set',
                    student.education?.branch || 'Not set',
                    student.education?.year || 'Not set',
                    student.skills || 'Not set',
                    student.experience || 'Not set'
                ].join(','))
            ].join('\n');

            const prompt = `
                You are an expert at analyzing student data. Given the following CSV data of students:
                ${csvText}
                
                And the user's requirement: "${query}"
                based on the requirement , find the best matched students , analyse each students datas and find out who will be the most suitable candidate with respect to the given requirement.
                Return EXACTLY 10 student IDs that best match the requirement, in order of relevance.
                If fewer than 10 exact matches exist, fill the remaining slots with the most relevant students available.
                Provide the response STRICTLY as a JSON array of 10 strings (student IDs) with no additional text, like this:
                ["id1", "id2", "id3", "id4", "id5", "id6", "id7", "id8", "id9", "id10"]
            `;

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o',
                        messages: [{ role: 'user', content: prompt }],
                        max_tokens: 2000
                    })
                });

                const data = await response.json();
                if (!response.ok) throw new Error(data.error?.message || 'API request failed');

                let shortlistedIds;
                try {
                    shortlistedIds = JSON.parse(data.choices[0].message.content);
                    if (!Array.isArray(shortlistedIds) || shortlistedIds.length !== 10 || !shortlistedIds.every(id => typeof id === 'string')) {
                        throw new Error('Invalid response format');
                    }
                } catch (parseError) {
                    console.error('JSON Parse Error:', parseError, 'Response:', data.choices[0].message.content);
                    // Fallback: Select first 10 students if AI response is invalid
                    shortlistedIds = studentsData.slice(0, 10).map(student => student.id);
                }

                const filteredStudents = studentsData
                    .filter(student => shortlistedIds.includes(student.id))
                    .sort((a, b) => shortlistedIds.indexOf(a.id) - shortlistedIds.indexOf(b.id));

                studentsList.innerHTML = filteredStudents.map(student => `
                 
                <div class="student-card">
                        <h3>${student.personal?.name || 'Unnamed'}</h3>
                        <h4>${student.education?.college || 'Not set'} - ${student.education?.branch || 'Not set'}</h4>
                        <p>${student.about || student.experience || 'No description available'}</p>
                        <div class="student-actions">
                            <button class="ai-intro-btn" onclick="generateAIIntro('${student.id}')">Connect</button>
                            <span class="view-profile" onclick="showProfile('${student.id}')">View Profile</span>
                            <div class="social-icons">
                                <i class="fab fa-linkedin social-icon linkedin" onclick="window.open('${student.personal?.linkedin || '#'}', '_blank')"></i>
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('AI Search Error:', error);
                studentsList.innerHTML = `<p>Error performing search: ${error.message}</p>`;
            }

            loadingOverlay.style.display = 'none';
        }

        window.performSearch = () => {
            const query = document.getElementById('ai-search-input').value.trim();
            aiSearch(query);
        };

        window.generateAIIntro = async (studentId) => {
            currentStudentId = studentId;
            loadingOverlay.style.display = 'flex';
            const message = await generateIntroMessage(studentId);
            introMessage.value = message;
            loadingOverlay.style.display = 'none';
            messagePopup.classList.add('active');
            overlay.classList.add('active');
        };

        async function generateIntroMessage(studentId) {
            const student = studentsData.find(s => s.id === studentId);
            
            const prompt = `
                Given the student's details:
                - Name: ${student.personal?.name || 'Unnamed'}
                - College: ${student.education?.college || 'Not set'}
                - Degree: ${student.education?.degree || 'Not set'}
                - Branch: ${student.education?.branch || 'Not set'}
                - Year: ${student.education?.year || 'Not set'}
                - Skills: ${student.skills || 'Not set'}
                - Experience: ${student.experience || 'Not set'}

                Create a friendly, professional introduction message (max 200 characters) to send via WhatsApp. 
                Introduce yourself briefly, mention interest in their background, and ask if they're interested in connecting.
            `;

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [{ role: 'user', content: prompt }],
                        max_tokens: 100
                    })
                });

                const data = await response.json();
                if (!response.ok) throw new Error(data.error?.message || 'API request failed');

                return data.choices[0].message.content.trim();
            } catch (error) {
                console.error('AI Intro Generation Error:', error);
                return `Hi ${student.personal?.name || 'there'}, I'm from Taska Elite. Impressed by your ${student.education?.branch || 'skills'} at ${student.education?.college || 'your college'}. Interested in connecting?`;
            }
        }

        window.showProfile = (targetUserId) => {
            const student = studentsData.find(s => s.id === targetUserId);
            if (student) {
                profileContent.innerHTML = `
                    <div class="profile-section">
                        <h2>${student.personal?.name || 'Unnamed'}</h2>
                        <p><strong>College:</strong> ${student.education?.college || 'Not set'}</p>
                        <p><strong>Branch:</strong> ${student.education?.branch || 'Not set'}</p>
                        <p><strong>Degree:</strong> ${student.education?.degree || 'Not set'}</p>
                        <p><strong>Year:</strong> ${student.education?.year || 'Not set'}</p>
                        <p><strong>Skills:</strong> ${student.skills || 'Not set'}</p>
                        <p><strong>Experience:</strong> ${student.experience || 'Not set'}</p>
                        <p><strong>Email:</strong> ${student.personal?.email || 'Not set'}</p>
                    </div>
                `;
                profilePopup.classList.add('active');
                overlay.classList.add('active');
            } else {
                profileContent.innerHTML = '<div class="profile-section"><h2>Profile Not Found</h2><p>No data available.</p></div>';
                profilePopup.classList.add('active');
                overlay.classList.add('active');
            }
        };

        window.closeProfilePopup = () => {
            profilePopup.classList.remove('active');
            overlay.classList.remove('active');
        };

        window.closeMessagePopup = () => {
            messagePopup.classList.remove('active');
            overlay.classList.remove('active');
            currentStudentId = null;
        };

        window.sendMessage = () => {
            if (!currentStudentId) return;
            
            const student = studentsData.find(s => s.id === currentStudentId);
            const message = introMessage.value.trim();
            
            if (!message) return;

            const phone = student.personal?.whatsapp || '';
            if (phone) {
                const whatsappUrl = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
                window.open(whatsappUrl, '_blank');
            }
            
            closeMessagePopup();
        };

        overlay.addEventListener('click', () => {
            closeProfilePopup();
            closeMessagePopup();
        });
    </script>
</body>
</html>